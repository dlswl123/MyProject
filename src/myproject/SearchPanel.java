package myproject;

import java.awt.BorderLayout;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Vector;

import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;

@SuppressWarnings("serial")
public class SearchPanel extends JPanel implements ActionListener {
	
	
//	JButton btnInsert = new JButton("입력");
	JButton btnSearchAll = new JButton("전체조회");
	JTextField txtSearch = new JTextField(10);
	String[] searchList = {"금액", "카테고리", "메모"};
	JComboBox<String> cmbSearch = new JComboBox<>(searchList);
	JButton btnSearch = new JButton("조회");
	JTextArea txaMessage = new JTextArea();
	String[] strArray = {"글자순", "금액순", "날짜순", "결제방법순" };
//	String[] strColumnNames = {"ledname", "ledmoney",  "ledday","ledtype"};
	JComboBox<String> cmbArrayType = new JComboBox<>(strArray);
//	JButton btnDelete = new JButton("삭제");
	
	ProjectDao dao = ProjectDao.getInstance();
	SearchDto dto = new SearchDto();
	
	public SearchPanel() {
		this.setLayout(new BorderLayout());
		JPanel pnlNorth = new JPanel(new GridLayout(2, 1));
		pnlNorth.setOpaque(false);
		JPanel pnlButtons = new JPanel();
		pnlButtons.setOpaque(false);
//		pnlButtons.add(btnInsert);
//		pnlButtons.add(btnDelete);
		pnlNorth.add(pnlButtons);
		JPanel pnlSearch = new JPanel();
		pnlSearch.setOpaque(false);
		pnlSearch.add(cmbSearch);
		pnlSearch.add(txtSearch);
		pnlSearch.add(btnSearch);
		pnlSearch.add(btnSearchAll);
		pnlSearch.add(cmbArrayType);
		btnSearchAll.addActionListener(this);
		btnSearch.addActionListener(this);
//		cmbArrayType.addActionListener(this);
		pnlNorth.add(pnlSearch);
		this.add(pnlNorth, BorderLayout.NORTH);
		
		this.add(new JScrollPane(txaMessage), BorderLayout.CENTER);
		
		
	} // 생성자
	
	@Override
	public void actionPerformed(ActionEvent e) {
		Object obj = e.getSource();
		String searchKey = null;
		String searchTxt = "";
		
		if(!(txtSearch.getText().equals(""))) {
			searchTxt = txtSearch.getText();
		}
		
		if (obj == btnSearch) {
			String search = (String)cmbSearch.getSelectedItem();
			System.out.println("btnSearch : " + search);
			if (search.equals("금액")) {
				searchKey = "ledmoney";
			} else if(search.equals("카테고리")) {
				searchKey = "ledname";
			} else if (search.equals("메모")) {
				searchKey = "ledmemo";
			}
			
			Vector<LegerVo> vec = dao.search(new SearchDto(searchKey, searchTxt));
			printMessage(vec);
			
		} else if (obj == btnSearchAll) {
			String searchArray = null;
			String item = (String)cmbArrayType.getSelectedItem();
//				System.out.println(item);
			SearchDto dto = new SearchDto();
			if (item.equals("글자순")) {
				searchArray = "ledname";
			} else if (item.equals("금액순")) {
				searchArray = "ledmoney";
			} else if (item.equals("날짜순")) {
				searchArray = "ledday";
			} else if (item.equals("결제방법순")) {
				searchArray = "ledtype";
			}
			dto.setSearchArray(searchArray);
			
			Vector<LegerVo> vec = dao.searchAll(dto);
			printMessage(vec);
			
//		} else if (obj == cmbArrayType) {
////			if () {
////				
////			}
//			JComboBox<String> cmb = (JComboBox<String>)obj;
//			int index = cmb.getSelectedIndex();
//			String orderColName = strColumnNames[index];
////			System.out.println(orderColName);
//			
//			Vector<LegerVo> vec = dao.searchAll(orderColName);
//			printMessage(vec);
		}
	}
	
	public void printMessage(Vector<LegerVo> vec) {
		txaMessage.setText("");
		for (LegerVo vo : vec) {
			int ledno = vo.getLedNo();
			String ledname = vo.getLedName();
			int ledmoney = vo.getLedMoney();
			String ledtype = vo.getLedType();
			String ledday = vo.getLedDay();
			String strLedday = "";
			if (ledday != null) {
				strLedday = ledday.substring(0, 10);
			}
			String ledmemo = vo.getLedMemo();
			String strLedmemo = "";
			if (ledmemo != null) {
				strLedmemo = ledmemo;
			}
			String message = ledno    + "\t|"
						   + ledname  + "\t|"
						   + ledmoney + "\t|"
						   + ledtype  + "\t|"
						   + strLedday   + "\t|"
						   + strLedmemo  + "\n";
			txaMessage.append(message);
		}
		txaMessage.append("======검색완료====== \n");
	}
	public void arrayType() {
		
	}
} // class
